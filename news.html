<!DOCTYPE html>
<!-- News page for Yokai eSports with live feed, archive, and search/filter UI -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Yokai eSports news, announcements, roster moves, and live updates." />
  <meta name="theme-color" content="#ff2e3c" />
  <title>Yokai eSports | News</title>
  <!-- Shared typography + base and page-specific styles -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Oswald:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/news.css">

</head>
<body>
  <!-- Primary site header with logo and top navigation -->
  <header class="site-header">
    <div class="header-inner">
      <div class="brand">
        <button class="icon-button" aria-label="Open menu" data-drawer-toggle>‚ò∞</button>
        <a class="logo" href="index.html">YOKAI</a>
      </div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="teams.html">Teams</a></li>
        <li><a href="partners.html">Partners</a></li>
        <li><a href="#latest">Latest</a></li>
      </ul>
      <div class="header-actions"></div>
    </div>
  </header>

  <!-- Mobile drawer navigation -->
  <aside class="drawer" data-drawer>
    <a class="logo" href="index.html">YOKAI</a>
    <a href="news.html">News</a>
    <a href="teams.html">Teams</a>
    <a href="content.html">Content</a>
    <a href="shop.html">Shop</a>
    <a href="partners.html">Partners</a>
    <div class="drawer-section">
      <a href="jobs.html">Jobs</a>
      <a href="contactPage.html">Contact</a>
      <a href="help.html">Help</a>
      <a href="termsOfServices.html" target="_blank">Terms</a>
      <a href="privacyPolicy.html" target="_blank">Privacy</a>
    </div>
    
  </aside>

  <div class="page">
    <!-- Hero banner -->
    <section class="hero" data-hero>
      <div class="hero-content">
        <span class="eyebrow">Live from the dojo</span>
        <h1>Yokai Newsroom</h1>
        <p>Roster moves, scrim highlights, and announcements‚Äîcurated and refreshed automatically.</p>
        <div class="button-row">
          <a class="btn primary" href="#latest">See latest updates</a>
          <a class="btn outline" href="#archive">Browse the archive</a>
        </div>
      </div>
    </section>

    <!-- Latest feed with search and filters -->
    <section id="latest" class="section">
      <div class="section-header">
        <h2>Latest feed</h2>
        <span class="muted">Pulled from our social + newsroom.</span>
      </div>
      <div class="search">
        <span>üîç</span>
        <input id="newsSearch" type="search" placeholder="Search announcements, roster moves, scrims..." aria-label="Search news">
      </div>
      <div class="two-col" style="margin-top:20px;">
        <div class="grid" id="latestNews">
          <p class="muted" data-feed-status>Loading live feed from X‚Ä¶</p>
        </div>
        <div class="card reveal">
          <h3>Filters</h3>
          <div class="pill-rail" id="filters">
            <button class="btn outline" data-filter="all">All</button>
            <button class="btn outline" data-filter="valorant">Valorant</button>
            <button class="btn outline" data-filter="cs2">CS2</button>
            <button class="btn outline" data-filter="roster">Roster</button>
            <button class="btn outline" data-filter="content">Content</button>
          </div>
          <p class="muted">Pro tip: use search + filters together to narrow down announcements.</p>
          <div class="button-row">
            <a class="btn primary" href="https://x.com/YokaieSportGG" target="_blank" rel="noreferrer">Follow on X ‚Üí</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Archived stories -->
    <section id="archive" class="section">
      <div class="section-header">
        <h2>Archive</h2>
        <span class="muted">Older drops still worth a read.</span>
      </div>
      <div class="grid" id="archiveGrid"></div>
    </section>
  </div>

  <!-- Simple footer attribution -->
  <footer class="footer">
    Copyright ¬© 2025 Yokai eSports ‚Äî Designed by Thomas Peters
  </footer>

  <script src="scripts/main.js"></script>
  <script>
    const searchInput = document.getElementById('newsSearch');
    const filterButtons = document.querySelectorAll('#filters .btn');

    // Normalize text to lowercase to simplify comparisons
    function normalize(text) {
      return text.toLowerCase();
    }

    // Applies search query + active filter to all news cards
    function filterCards() {
      const query = normalize(searchInput.value.trim());
      const activeFilter = document.querySelector('#filters .btn.active')?.dataset.filter || 'all';
      const cards = document.querySelectorAll('[data-news-card]');

      cards.forEach(card => {
        const text = normalize(card.innerText);
        const tags = normalize(card.dataset.tags || '');
        const matchesQuery = !query || text.includes(query);
        const matchesFilter = activeFilter === 'all' || tags.includes(activeFilter);
        card.style.display = matchesQuery && matchesFilter ? '' : 'none';
      });
    }

    searchInput?.addEventListener('input', filterCards);
    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        filterButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filterCards();
      });
    });

    // Start with "All" selected and apply initial filter state
    filterButtons[0]?.classList.add('active');
    filterCards();

    // Fetch live tweets from the backend and hydrate the latest feed
    // GitHub Pages-friendly: pull pre-generated JSON from the repo (see data/news.json)
    const TWEETS_API = 'data/news.json';

    const feedStatus = document.querySelector('[data-feed-status]');
    const latestGrid = document.getElementById('latestNews');
    const archiveGrid = document.getElementById('archiveGrid');

    const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      return `${MONTHS[d.getUTCMonth()]} ${d.getUTCDate()}, ${d.getUTCFullYear()}`;
    }

    function extractTags(text) {
      const tags = [];
      const regex = /#([\\w]+)/g;
      let m;
      while ((m = regex.exec(text)) !== null) tags.push(m[1].toLowerCase());
      return tags.length ? tags : ['social'];
    }

    function renderCard(tweet) {
      const tags = extractTags(tweet.text || '');
      const primaryTag = tags[0] || 'Live';
      const formattedDate = formatDate(tweet.created_at);
      const href = `https://x.com/${tweet.username}/status/${tweet.id}`;
      const div = document.createElement('article');
      div.className = 'card news-card reveal';
      div.dataset.newsCard = 'true';
      div.dataset.tags = tags.join(' ');
      div.innerHTML = `
        <span class="tag">${primaryTag}</span>
        <h3>${tweet.text}</h3>
        <div class="news-meta">
          ${formattedDate ? `<time datetime="${tweet.created_at}">${formattedDate}</time>` : ''}
          <span class="badge">X</span>
        </div>
        <p class="news-meta" style="margin:0;"><a class="cta" href="${href}" target="_blank" rel="noreferrer">View on X ‚Üí</a></p>
      `;
      return div;
    }

    function renderFeed(tweets) {
      latestGrid.innerHTML = '';
      archiveGrid.innerHTML = '';
      if (!tweets.length) {
        feedStatus.textContent = 'No live updates yet.';
        latestGrid.appendChild(feedStatus);
        return;
      }
      const latest = tweets.slice(0, 6);
      const archive = tweets.slice(6);
      latest.forEach(t => latestGrid.appendChild(renderCard(t)));
      archive.forEach(t => archiveGrid.appendChild(renderCard(t)));
      feedStatus.remove();
      filterCards();
    }

    async function loadTweets() {
      try {
        const res = await fetch(TWEETS_API);
        if (!res.ok) throw new Error('Bad response');
        const data = await res.json();
        if (!data.tweets || !Array.isArray(data.tweets)) throw new Error('Malformed payload');
        renderFeed(data.tweets);
      } catch (err) {
        console.error('Failed to load tweets', err);
        if (feedStatus) feedStatus.textContent = 'Unable to load live feed. Check your API endpoint.';
      }
    }

    loadTweets();
  </script>
</body>
</html>
